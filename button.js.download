hubspot.define("ZorseButtonUI/js/button",[],function(){"use strict";function e(e,t,i){e.addEventListener?e.addEventListener(t,i):e.attachEvent("on"+t,function(){i.call(e)})}function t(e,t,i){e.removeEventListener?e.removeEventListener(t,i):e.detachEvent("on"+t,i)}function i(e,t){e.appendChild(t)}function n(e){var t=document.createElement("div");t.innerHTML=e;return t}function s(e,t){if(e)if(e.classList)e.classList.remove(t);else{var i=new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi");e.className.replace(i," ")}}function o(e,t){e&&(e.classList?e.classList.add(t):e.className+=" "+t)}function a(e,t){void 0!==e.textContent?e.textContent=t:e.innerText=t}function r(e,t,i){e.setAttribute(t,i)}var c={},l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},d=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,i,n){i&&e(t.prototype,i);n&&e(t,n);return t}}();Object.defineProperty(c,"__esModule",{value:!0});var u=1e3,h=600,p=440,g=9e5,f="autoOpenZorseCreateView=true",m="autoOpenWidgetArticle=",v="zorse/v2/notifications",b="zorse-webticket",w="livechat/v1/message/public/hubspot-app",y="hubspot:isc:userIsEligibleForIscChat",I="hubspot:isc:userHasDismissedIscEligibilityPopup",C=3e4,k=function(){function c(e,t){l(this,c);this.cleanAutoOpenQueryString=this.cleanAutoOpenQueryString.bind(this);this.closeWidget=this.closeWidget.bind(this);this.handleReceivePostMessage=this.handleReceivePostMessage.bind(this);this.hideShowWidget=this.hideShowWidget.bind(this);this.maybeGetNotifications=this.maybeGetNotifications.bind(this);this.openWidget=this.openWidget.bind(this);this.renderNotifications=this.renderNotifications.bind(this);this.resizeIframe=this.resizeIframe.bind(this);this.setHelpButtonAndBindButtonEvents=this.setHelpButtonAndBindButtonEvents.bind(this);this.userCanCreateTickets=this.userCanCreateTickets.bind(this);this.widgetContentsLoaded=this.widgetContentsLoaded.bind(this);this.onOpenCloseWidget=this.onOpenCloseWidget.bind(this);this.fireOpenCloseWidgetCallbacks=this.fireOpenCloseWidgetCallbacks.bind(this);this.handleIscEligibilityResponse=this.handleIscEligibilityResponse.bind(this);this.maybeRequestIsUserIscChatEnabled=this.maybeRequestIsUserIscChatEnabled.bind(this);this.makeIsUserIscChatEnabledRequest=this.makeIsUserIscChatEnabledRequest.bind(this);this.maybeIscPopupTemplate=this.maybeIscPopupTemplate.bind(this);this.closeIscPopup=this.closeIscPopup.bind(this);this.setupZorse=this.setupZorse.bind(this);this.openCloseWidgetCallbacks=[];this.userIsEligibleForIscChat=!1;if(e&&t){this.hubhttp=e;this.userInfo=t;this.maybeGetNotifications();this.maybeRequestIsUserIscChatEnabled()}else this.setupZorse();window.hubspot.PortalIdParser&&window.hubspot.PortalIdParser.get();this.chatMessageCount=0}d(c,[{key:"setupZorse",value:function(){var e=this.userIsEligibleForIscChat?this.closedIscWidgetTemplate():this.closedWidgetTemplate();this.widget=n(e);i(document.body,this.widget);this.setHelpButtonAndBindButtonEvents(this.openWidget,this.closeIscPopup);var t=document.getElementsByTagName("html");if(t&&t[0]){this.html=t[0];o(this.html,"zorse")}window.addEventListener&&window.addEventListener("message",this.handleReceivePostMessage);if(window.location&&window.location.search)if(-1!==window.location.search.indexOf(f)){this.openWidget({create:!0,autoOpened:!0});setTimeout(this.cleanAutoOpenQueryString,u)}else if(-1!==window.location.search.indexOf(m)){var s=window.location.search.indexOf(m)+m.length,a=window.location.search.indexOf("&",s),r="";r=-1!=a?window.location.search.substring(s,a):window.location.search.substr(s);this.openWidget({url:r});setTimeout(this.cleanAutoOpenArticleQueryString,u,r)}this.isChatActive()&&(this.userIsEligibleForIscChat?this.openWidget({isc:!0}):this.openWidget({chat:!0}))}},{key:"isChatActive",value:function(){return document&&document.cookie&&(-1!==document.cookie.indexOf("_bc-curl")||-1!==document.cookie.indexOf("zorse-active-conversation"))}},{key:"makeIsUserIscChatEnabledRequest",value:function(){var e=this,t="undefined"!=typeof I18n?I18n.lang:"en",i=""+window.location.href+(window.location.search?"&":"?")+"iscChatLang="+t;this.hubhttp.get(w,{query:{embeddedPortalId:this.isQa()?99535353:53,mobile:!1},headers:{"X-HubSpot-Messages-Uri":i}}).then(function(t){var i="HIDE_WIDGET"!==t.type;e.userIsEligibleForIscChat=i;localStorage.setItem(y,JSON.stringify({eligible:i,timestamp:Date.now()}));e.handleIscEligibilityResponse()},function(){e.handleIscEligibilityResponse()})}},{key:"maybeRequestIsUserIscChatEnabled",value:function(){var e=this;if(localStorage.getItem(""+y+":override")){this.userIsEligibleForIscChat=!0;this.handleIscEligibilityResponse();localStorage.setItem(y,JSON.stringify({eligible:!0,timestamp:Date.now()}))}else if(window.hubspot.portal&&window.hubspot.portal.id){var t=localStorage.getItem(y);if(t){var i=JSON.parse(t);if(Date.now()-i.timestamp>g)this.makeIsUserIscChatEnabledRequest();else{this.userIsEligibleForIscChat=i.eligible;this.handleIscEligibilityResponse()}}else this.userInfo().then(function(t){var i=t.user;e.userCanCreateTickets(i)?e.setupZorse():e.makeIsUserIscChatEnabledRequest()},function(){return e.setupZorse()})}}},{key:"cleanAutoOpenArticleQueryString",value:function(e){"undefined"!=typeof window.history&&window.history&&window.history.replaceState&&document.title&&window.history.replaceState({},document.title,""+window.location.pathname+window.location.search.replace(m+e,""))}},{key:"cleanAutoOpenQueryString",value:function(){"undefined"!=typeof window.history&&window.history&&window.history.replaceState&&document.title&&window.history.replaceState({},document.title,""+window.location.pathname+window.location.search.replace(f,""))}},{key:"handleReceivePostMessage",value:function(e){var t=void 0;try{t=JSON.parse(e.data)}catch(i){hubspot.zorse.dev&&console&&console.error("Help button received an unparsable postMessage:",i,e);return}if(t.name)switch(t.name){case"close":return this.closeWidget();case"minimize":return this.hideShowWidget(!0);case"restore":return this.hideShowWidget(!1);case"loaded":return this.widgetContentsLoaded(t);case"resize":return this.resizeIframe(t);case"chat-message":return this.renderChatNotifications(!0);default:hubspot.zorse.dev&&console&&console.log("Help button received postMessage with no handler:",t)}}},{key:"maybeGetNotifications",value:function(){var e=this;this.userInfo().then(function(t){var i=t.user;e.userCanCreateTickets(i)&&e.hubhttp.get(v).then(e.renderNotifications)["catch"](function(e){hubspot.zorse.dev&&console&&console.log("Caught error from notifications request:",e)})})["catch"](function(e){hubspot.zorse.dev&&console&&console.log("Caught error from userInfo request:",e)})}},{key:"renderNotifications",value:function(e){this.notificationResponse=e||this.notificationResponse;if(this.notificationResponse&&this.notificationResponse.count){var t=document.getElementById("help-widget-toggle"),i=document.getElementById("zorse-button-zorse-notification"),n=document.getElementById("zorse-button-zorse-notification-count"),c=document.getElementById("zorse-button-zorse-notification-avatar");if(t&&i){a(n,this.notificationResponse.count);o(t,"has-notification");!this.userIsEligibleForIscChat&&c&&r(c,"src",this.notificationResponse.agentAvatarUrl);s(i,"hidden")}}}},{key:"renderChatNotifications",value:function(e){var t=document.getElementById("zorse-button-chat-notification"),i=document.getElementById("zorse-button-chat-notification-count");if(t)if(e){if(!this.isWidgetOpen()){this.chatMessageCount++;a(i,this.chatMessageCount);s(t,"hidden")}}else{o(t,"hidden");this.chatMessageCount=0}}},{key:"openWidget",value:function(e){var i=this;e=e||{};t(this.helpButton,"click",this.openWidget);if(window.hubspot.portal&&window.hubspot.portal.id){this.userIsEligibleForIscChat&&localStorage.setItem(I,"true");var n=window.hubspot.portal.id,s=this.addCorsSensitivePropertiesToRoute(this.getRouteFromOptions(e)),o=(this.notificationResponse?this.notificationResponse.count:void 0)?"has-notification":"";this.widget.innerHTML=this.openWidgetTemplate(n,s,o);this.setHelpButtonAndBindButtonEvents(function(){return i.hideShowWidget(!1)},this.closeIscPopup);this.fireOpenCloseWidgetCallbacks(!0)}else console&&console.error("Could not deduce portal id from hubspot object")}},{key:"getRouteFromOptions",value:function(e){e=e||{};return e.create?"create?autoOpened="+!!e.autoOpened:e.migrationId?"migration?migrationId="+e.migrationId:e.feedback?"feedback":e.url||e.kbArticle?this.generateUrlRoute(e.url||e.kbArticle):e.chat?"chat":e.isc?"isc-chat":""}},{key:"generateUrlRoute",value:function(e){e&&e.indexOf("/")>-1&&(e=encodeURIComponent(e));return"url?location="+e+"?zorseWidget"}},{key:"addCorsSensitivePropertiesToRoute",value:function(e){var t={title:window.document&&window.document.title?window.document.title:"",href:window.location&&window.location.href?window.location.href:"",pathname:window.location&&window.location.pathname?window.location.pathname:"",navigation_rendered_mode:window.hubspot&&window.hubspot.navigation_rendered_mode||"MARKETING"},i=Object.keys(t).map(function(e){return""+e+"="+encodeURIComponent(t[e])}).join("&");return-1!==e.indexOf("?")?""+e+"&"+i:""+e+"?"+i}},{key:"widgetContentsLoaded",value:function(){var e=document.getElementById("zorse-iframe"),t=document.querySelector("#help-widget .zorse-loading-container");s(e,"hidden");t&&t.parentNode&&t.parentNode.removeChild(t);this.toggleZorseOpenedClass(!0)}},{key:"resizeIframe",value:function(e){var t=document.getElementById("zorse-iframe"),i="undefined"!=typeof e&&e&&e.payload&&e.payload.height?Math.max(e.payload.height,h):h,n="undefined"!=typeof e&&e&&e.payload&&e.payload.width?Math.max(e.payload.width,p):p;if(t){t.style.height=""+i+"px";t.style.width=""+n+"px"}}},{key:"setHelpButtonAndBindButtonEvents",value:function(t,i){if(this.userIsEligibleForIscChat){var n=document.getElementById("bubble-close-button");n&&e(n,"click",i);this.helpButton=document.getElementById("isc-help-button");e(this.helpButton,"click",this.openWidget);this.iscChatButton=document.getElementById("isc-chat-button");e(this.iscChatButton,"click",this.openWidget.bind(this,{isc:!0}))}else{this.helpButton=document.getElementById("help-widget-toggle");e(this.helpButton,"click",t)}}},{key:"handleIscEligibilityResponse",value:function(){var e=this;this.setupZorse();this.userIsEligibleForIscChat&&this.setHelpButtonAndBindButtonEvents(function(){return e.openWidget({isc:!0})},this.closeIscPopup)}},{key:"closeWidget",value:function(){this.userIsEligibleForIscChat?this.widget.innerHTML=this.closedIscWidgetTemplate():this.widget.innerHTML=this.closedWidgetTemplate();this.maybeGetNotifications();this.setHelpButtonAndBindButtonEvents(this.openWidget,this.closeIscPopup);this.toggleZorseOpenedClass(!1);this.fireOpenCloseWidgetCallbacks(!1)}},{key:"fireOpenCloseWidgetCallbacks",value:function(e){this.openCloseWidgetCallbacks.forEach(function(t){if("function"==typeof t)try{t(e)}catch(i){console.error(i)}})}},{key:"onOpenCloseWidget",value:function(e){if("function"!=typeof e)return!1;var t=function(t){return t===e};if(this.openCloseWidgetCallbacks.some(t))return!1;this.openCloseWidgetCallbacks.push(e);return!0}},{key:"hideShowWidget",value:function(e){var t=document.getElementById("zorse-iframe"),i=document.getElementById("help-widget-toggle");if(t&&i){t.style.display=e?"none":"";i.style.display=e?"":"none"}this.renderNotifications();this.toggleZorseOpenedClass(!e);this.userIsEligibleForIscChat||this.renderChatIcon();e||this.renderChatNotifications(!1)}},{key:"renderChatIcon",value:function(){var e=document.getElementById("help-widget-toggle"),t=document.querySelector(".zorse-help-text"),i=document.querySelector(".zorse-chat-container"),n=document.getElementById("zorse-button-zorse-notification");t.textContent=this.getHelpText();if(this.isChatActive()){i.style.display="block";o(t,"zorse-chat-margin");s(e,"has-notification");o(e,"has-chat");this.notificationResponse&&this.notificationResponse.count&&(n.style.display="none")}else{i.style.display="none";s(t,"zorse-chat-margin");s(e,"has-chat");this.notificationResponse&&this.notificationResponse.count&&(n.style.display="inline-block")}}},{key:"getHelpText",value:function(){return this.isChatActive()?this.translatedChatText():this.translatedHelpText()}},{key:"toggleZorseOpenedClass",value:function(e){this.html&&(e?o(this.html,"zorse-opened"):s(this.html,"zorse-opened"))}},{key:"isWidgetOpen",value:function(){var e=document.getElementById("zorse-iframe");return"none"!==e.style.display}},{key:"closedWidgetTemplate",value:function(){var e=void 0===arguments[0]?!0:arguments[0];return"<div id='chat-widget' data-html2canvas-ignore='true'>\n        <div id='help-widget' class='"+(e?"fade-in":"")+"'>\n          <a id='help-widget-toggle'>\n            "+this.widgetLinkTemplate()+"\n          </a>\n        </div>\n      </div>"}},{key:"closedIscWidgetTemplate",value:function(){var e=void 0===arguments[0]?!0:arguments[0];return'\n    <div id="isc-zorse-widget" data-html2canvas-ignore="true">\n      '+this.maybeIscPopupTemplate()+'\n      <div id="isc-help-widget" class="'+(e?"fade-in":"")+'">\n          <div id=\'zorse-button-chat-notification\' class=\'zorse-notification hidden\'>\n            <div id=\'zorse-button-chat-notification-count\' class=\'zorse-notification-count\'>1</div>\n          </div>\n          <div class="isc-help-widget__layout-container">\n            <div class="isc-help-widget__button-container" id="isc-chat-button">\n                <div class="isc-help-widget__chat-button">\n                  <img class="isc-help-widget__chat-icon" src="'+this.getStaticDomain()+'/ZorseButtonUI/static-1.501/images/isc-chat-icon.svg" />'+this.translatedChatText()+'\n                </div>\n            </div>\n            <div class="isc-help-widget__button-container" id="isc-help-button"><span class="isc-help-widget__help-button">'+this.translatedHelpText()+"</span></div>\n          </div>\n      </div>\n    </div>\n    "}},{key:"openWidgetTemplate",value:function(e,t,i){return"<div id='help-widget' data-html2canvas-ignore='true'>\n        <a class='zorse-loading-container "+i+"'>\n          <div class='loading loading_1'></div>\n          <div class='loading loading_2'></div>\n          <div class='loading loading_3'></div>\n        </a>\n        <iframe id='zorse-iframe' class='zorse-widget-container hidden' src='"+this.getWidgetDomain()+"/help-widget-v2/"+e+"/"+t+"' scrolling='no'></iframe>\n        <a id='help-widget-toggle' style='display: none'>\n          "+(this.userIsEligibleForIscChat?this.closedIscWidgetTemplate(!1):this.widgetLinkTemplate())+"\n        </a>\n      </div>"}},{key:"getStaticDomain",value:function(){return this.staticDomain?this.staticDomain:this.isLocal()?this.staticDomain="//"+window.location.hostname:this.staticDomain="https://static.hsappstatic.net"}},{key:"getWidgetDomain",value:function(){if(this.widgetDomain)return this.widgetDomain;if(this.isLocal())this.widgetDomain="//"+window.location.hostname;else{var e=this.isQa()?"qa":"";this.widgetDomain="https://app.hubspot"+e+".com"}return this.widgetDomain}},{key:"isLocal",value:function(){return hubspot.zorse.dev||"undefined"!=typeof enviro&&enviro&&"local"===enviro.getShort("ZORSE_WIDGET")}},{key:"isQa",value:function(){return window.enviro&&window.enviro.isQa()}},{key:"userCanCreateTickets",value:function(e){return e&&e.scopes&&e.scopes.includes?e.scopes.includes(b):!1}},{key:"chatImageLinkTemplate",value:function(){var e="undefined"!=typeof I18n&&I18n&&I18n.langEnabled&&-1!=["de","ja"].indexOf(I18n.lang),t=e?56:35,i=""+this.getStaticDomain()+"/ZorseButtonUI/static-1.501/images/logo.jpg";return"<div class='zorse-chat-container' style='display: none; right: "+t+'px;\'>\n        <img class="logo" src="'+i+'" >\n      </div>'}},{key:"widgetLinkTemplate",value:function(){return"<div class='zorse-magnifying-glass'></div>\n      "+this.chatImageLinkTemplate()+"\n      <div id='zorse-button-zorse-notification' class='zorse-notification hidden'>\n        <img id='zorse-button-zorse-notification-avatar' class='zorse-avatar-image'></img>\n        <div id='zorse-button-zorse-notification-count' class='zorse-notification-count'></div>\n      </div>\n      <div id='zorse-button-chat-notification' class='zorse-notification hidden'>\n        <div id='zorse-button-chat-notification-count' class='zorse-notification-count'>1</div>\n      </div>\n      <span class='zorse-help-text'>"+this.getHelpText()+"</span>"}},{key:"maybeIscPopupTemplate",value:function(){if(this.userIsEligibleForIscChat&&!localStorage.getItem(I)){this.autodismissIscBubbleTemplateTimeout=setTimeout(this.closeIscPopup,C);return'<div id="isc-text-bubble-popup-container">\n          <div id="bubble-box">\n            <div id="bubble-close-button"><svg xmlns="http://www.w3.org/2000/svg" width="10" viewBox="0 0 1000 1000" fill="black"><path d="M29.8 970.2a67.7 67.7 0 0 0 95.7 0L500 595.7l374.5 374.5a67.7 67.7 0 0 0 95.7-95.7L595.7 500l374.5-374.5a67.7 67.7 0 0 0-95.7-95.7L500 404.3 125.5 29.8a67.7 67.7 0 0 0-95.7 95.7L404.3 500 29.8 874.5a67.7 67.7 0 0 0 0 95.7z"/></svg></div>\n          <div>\n              <div id="text-content">'+this.translatedIscWelcomeTest()+'</div>\n            </div>\n          </div>\n          <svg id="bubble-tail" width="30" height="30" viewbox="0 0 43 30" xmlns="http://www.w3.org/2000/svg">\n            <path d="M20 29.8a79.3 79.3 0 0 1-15.2-14A30.8 30.8 0 0 1 0 .9h43a88.5 88.5 0 0 0-17.7 15c-2.1 3-3.3 7.3-3.7 13.2a1 1 0 0 1-1.6.8z" fill="#fff" fill-rule="evenodd" />\n          </svg>\n        </div>'}return""}},{key:"closeIscPopup",value:function(){localStorage.setItem(I,"true");clearTimeout(this.autodismissIscBubbleTemplateTimeout);var e=document.getElementById("isc-text-bubble-popup-container");e&&o(e,"hidden")}},{key:"translatedChatText",value:function(){if("undefined"!=typeof I18n&&I18n&&I18n.langEnabled&&I18n.lang)switch(I18n.lang){case"de":return"Chatten";case"es":return"Chat";case"fr":return"Chat";case"ja":return"チャット";case"pt":case"pt-br":return"Chat"}return"Chat"}},{key:"translatedHelpText",value:function(){if("undefined"!=typeof I18n&&I18n&&I18n.langEnabled&&I18n.lang)switch(I18n.lang){case"de":return"Hilfe";case"es":return"Ayuda";case"fr":return"Aide";case"ja":return"ヘルプ";case"pt":case"pt-br":return"Ajuda"}return"Help"}},{key:"translatedIscWelcomeTest",value:function(){if("undefined"!=typeof I18n&&I18n&&I18n.langEnabled&&I18n.lang)switch(I18n.lang){case"de":return"Hallo! Haben Sie noch Fragen zum Setup? Wir helfen gerne weiter!";case"es":return"Hola, ¿tienes alguna pregunta sobre la configuración? Estamos aquí para ayudar.";case"fr":return"Bonjour, avez-vous des questions concernant l'installation? Nous sommes là pour vous aider.";case"ja":return"セットアップに関してご不明な点はございますか？ご遠慮なくお問い合わせください。";case"pt":case"pt-br":return"Olá, tem alguma pergunta sobre configuração? Nós estamos aqui para ajudar."}return"Hi there, have any set up questions? We're here to help."}}]);return c}();c=k;return c});hubspot.define("js.button",["ZorseButtonUI/js/button"],function(e){return e});